<div id="{{ uid }}">
	<h1>{{ tr.get('manage_articles') }}</h1>

	<div class="btn-group" style="padding:20px 0;">
		<a class="btn btn-info" href="#article/addNew" title="{{ tr.get('add_new_article') }}"><i class="glyphicon glyphicon-plus"></i> {{ tr.get('add_new_article') }}</a>
		<a class="btn btn-default reload" title="{{ tr.get('reload') }}"><i class="glyphicon glyphicon-repeat"></i> {{ tr.get('reload') }}</a>
	</div>
	
	<div class="clearfix well tagFilter" style="font-size: 1.2em">
		{% for tag in tags %}
			{% if tag %}
			<span class="label label-{% if tag in active_tags %}primary{% else %}default{% endif %}">{{ tag }}</span>
			{% endif %}
		{% endfor %}

	</div>

	{% if delete_tag %}
		<div class="well well-sm clearfix" style="margin: 10px 0 20px 0;">
			<span class="text-danger">
				<i style="font-size:1.5em;" class="glyphicon glyphicon-exclamation-sign"></i> 
				{{ tr.sget('confirm_delete_tag_not_used', delete_tag) }}</span> 
				<button class="btn btn-danger deleteTag"><i class="glyphicon glyphicon-trash"></i> {{ tr.get('delete') }}</button>
				<button class="btn btn-danger deleteAllTags"><i class="glyphicon glyphicon-fire"></i> {{ tr.get('delete_unused_tags') }}</button>
		</div>
	{% endif %}




	<table class="table table-striped table-bordered table-hover data_table table-responsive">
		<thead>
			<tr>
				<th>{{ tr.get('id') }}</th>
				<th>{{ tr.get('title') }}</th>
				<th>{{ tr.get('textid') }}</th>
				<th>{{ tr.get('status') }}</th>
				<th>{{ tr.get('sorting') }}</th>
				<th></th>
			</tr>
		</thead>

		<tbody>
		{% for art in art_arr %}
			<tr>
				<td>{{ art.id }}</td>
				<td><a href="#article/edit/{{ art.id }}">{{ art.title }}</a></td>
				<td>{{ art.textid }}</td>
				<td>{{ art.status }}</td>
				<td>{{ art.sort }}</td>
				<td>
					<div class="btn-group">
						<a href="#article/edit/{{ art.id }}" class="btn btn-default" title="{{ tr.get('edit') }}"><i class="glyphicon glyphicon-edit"></i></a>
						{% for lang in cfg_langs %}
							<a href="#article/translate/{{ lang.id }}/{{ art.id }}" class="btn btn-default" title="{{ tr.get('translate_article_in', lang.string) }}"><i class="glyphicon glyphicon-random text-muted"></i> {{ lang.id|upper }}</a>
						{% endfor %}
						<a href="#" class="btn btn-default delete_article" data-id="{{ art.id }}" title="{{ tr.get('delete') }}"><i class="glyphicon glyphicon-trash"></i></a>
					</div>
				</td>
			</tr>
			{% endfor %}
		</tbody>

	</table>
</div>

<script>
$('#{{ uid }} a.reload').click(function(){
	admin.tabs.reloadActive();
	return false;
});

$('#{{ uid }} a.delete_article').click(function(){
	var $this = $(this);
	admin.dialog({
		title: '{{ tr.get('pay_attention_please') }}',
		html: '{{ tr.get('confirm_delete_article') }}',
		buttons:[
		         {
		        	 text: '{{ tr.get('close') }}',
		        	 action: 'close'
		         },
		         {
		        	 text: '{{ tr.get('delete') }}',
		        	 addclass: 'btn-danger',
		        	 action: 'close',
		        	 click: function(){
		        		 $.get('controller.php?obj=article_ctrl&method=delete&param[]=' + $this.data('id'), function(data){
		        			 admin.message(data.text, data.type);
		        			 if (data.type == 'success'){
		        				 
		        				 admin.tabs.reloadActive();
		        			 }
		        		 }, 'json')
		        	 }
		         }
		         ]
	});
});

$('#{{ uid }} table.data_table').dataTable({
	"iDisplayLength": 10,
	"bDestroy": true
});

$('#{{ uid }} .tagFilter span').on('click', function(){
	var selected = [];
	
	$.each($(this).siblings('.label-primary'), function(i, el){
		selected.push($(el).text());
	});
	
	if (!$(this).hasClass('label-primary')){
		selected.push($(this).text());
	}
	
	admin.tabs.closeActive('article/all' + (selected.length ? '/' + selected.join('/') : ''));
});

{% if delete_tag %}
	$('#{{ uid }} .deleteTag').on('click', function(){
		
		$.get('controller.php?obj=article_ctrl&method=deleteTag&tag={{ delete_tag }}', function(data){
			if (!data){
				admin.tabs.closeActive('article/all');
			} else {
				admin.message(data, 'error');
			}
		});
	});
	
	
	$('#{{ uid }} .deleteAllTags').on('click', function(){
		$.get('controller.php?obj=article_ctrl&method=deleteAllTags', function(data){
			if (!data){
				admin.tabs.closeActive('article/all');
			} else {
				admin.message(data, 'error');
			}
		});
	});
{% endif %}
</script>

